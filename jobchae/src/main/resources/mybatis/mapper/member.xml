<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== mapper Í∏∞Î≥∏ÏÑ§Ï†ï ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ==== Î£®Ìä∏ ÏóòÎ¶¨Î®ºÌä∏ & ÎÑ§ÏûÑÏä§ÌéòÏù¥Ïä§ ÏÑ§Ï†ï(ÌîÑÎ°úÏ†ùÌä∏ Ï†ÑÏ≤¥ÎÇ¥ÏóêÏÑú Ïú†ÏùºÌï¥Ïïº ÌïúÎã§.) ==== -->
<mapper namespace="com.spring.app.member.model.MemberDAO">
	
	<!-- === Ïù¥Ï§ÄÏòÅ ÏãúÏûë === -->
	
	<!-- ÏïÑÏù¥Îîî Ï§ëÎ≥µÏ≤¥ÌÅ¨ -->
	<select id="idDuplicateCheck" parameterType="String" resultType="String">
		SELECT MEMBER_ID
		FROM TBL_MEMBER
		WHERE MEMBER_ID = #{member_id}
	</select>
	
	
	
	<!-- Ïù¥Î©îÏùº Ï§ëÎ≥µÏ≤¥ÌÅ¨ -->
	<select id="emailCheck" parameterType="String" resultType="String">
		select member_email
		from tbl_member
		where member_email = #{member_email}
	</select>
	
	
	<!-- ÏßÄÏó≠ Í≤ÄÏÉâ ÏûêÎèô ÏôÑÏÑ± -->
	<resultMap type="HashMap" id="regionMap">
		<result property="region_no" column="REGION_NO" javaType="String" />
		<result property="region_name" column="REGION_NAME" javaType="String" />
	</resultMap>
	<select id="regionSearchShow" parameterType="String" resultMap="regionMap">
		SELECT REGION_NO, REGION_NAME
		FROM TBL_REGION
		WHERE REGION_NAME LIKE '%' || #{region_name} || '%'
	</select>
	
	
	<!-- ÌöåÏõêÍ∞ÄÏûÖ --> 
	<insert id="memberRegister" parameterType="MemberVO">
		
		INSERT INTO tbl_member(member_id, fk_region_no, member_passwd, member_name, member_birth, 
							   	   member_email, member_tel, member_profile, member_background_img)
		VALUES(#{member_id}, to_number(#{fk_region_no}), #{member_passwd}, #{member_name}, to_date(#{member_birth}, 'yyyy-mm-dd'),
			   #{member_email}, #{member_tel}, #{member_profile}, #{member_background_img})
	</insert>
	<!-- ÌöåÏõêÍ∞ÄÏûÖÏãú ÌöåÏõêÏÑ§Ï†ï Ï∂îÍ∞ÄÌïòÍ∏∞ -->
	<insert id="insertMemberSetting" parameterType="String">
		INSERT INTO tbl_member_setting(fk_member_id, member_setting_profile
					, member_setting_followed, member_setting_message
					, member_setting_following_board, member_setting_comment)
		VALUES(#{member_id}, default, default, default, default, default)
	</insert>

	
	<!-- Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨ÌïòÍ∏∞, Ïä§ÏºÄÏ§ÑÎü¨ ÏôÑÏÑ±ÎêòÎ©¥ Ï°∞Ïù∏Î¨∏ÏùÑ ÏÇ≠Ï†úÌïòÏûê. -->
	<select id="getLoginMember" parameterType="HashMap" resultType="MemberVO">	
		SELECT NVL(lastlogingap, TRUNC(MONTHS_BETWEEN(SYSDATE, MEMBER_REGISTER_DATE))) AS lastlogingap, -- Î°úÍ∑∏Ïù∏ Í∞ÑÍ≤©
       		   TRUNC(months_between(SYSDATE, MEMBER_PASSWDUPDATE_DATE)) AS passwdchangegap,             -- ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω Í∞ÑÍ≤©
       		   MEMBER_ID,                   -- ÌöåÏõê ÏïÑÏù¥Îîî
       		   M.FK_REGION_NO,              -- ÏßÄÏó≠ ÏùºÎ†®Î≤àÌò∏
       		   MEMBER_PASSWD,               -- ÎπÑÎ∞ÄÎ≤àÌò∏
       		   MEMBER_NAME,                 -- ÏÑ±Î™Ö
       		   to_char(MEMBER_BIRTH, 'yyyy-mm-dd') AS MEMBER_BIRTH, -- ÏÉùÎÖÑÏõîÏùº
       		   MEMBER_EMAIL,                -- Ïù¥Î©îÏùº
       		   MEMBER_TEL,                  -- Ï†ÑÌôîÎ≤àÌò∏
       		   MEMBER_REGISTER_DATE,        -- Í∞ÄÏûÖÏùºÏûê ,Í∏∞Î≥∏ÏùÄ SYSDATE
       		   MEMBER_STATUS,               -- Í∞ÄÏûÖÏÉÅÌÉú ,default 1,  Ï†ïÏÉÅ: 1, ÌÉàÌá¥: 2, Ï†ïÏßÄ:3
       		   MEMBER_IS_COMPANY,           -- Í∏∞ÏóÖ Ïó¨Î∂Ä ,Í∏∞Î≥∏Í∞í 0 0:Í∞úÏù∏ 1: Í∏∞ÏóÖ
       		   MEMBER_IDLE,                 -- Ìú¥Î©¥ÏÉÅÌÉú ,Í∏∞Î≥∏Í∞í 0, 0: Ï†ïÏÉÅ 1: Ìú¥Î©¥ (ÎßàÏßÄÎßâÏúºÎ°ú Î°úÍ∑∏Ïù∏ Ìïú ÎÇ†ÏßúÏãúÍ∞ÑÏù¥ ÌòÑÏû¨ÏãúÍ∞ÅÏúºÎ°ú Î∂ÄÌÑ∞ 1ÎÖÑÏù¥ ÏßÄÎÇ¨ÏúºÎ©¥ Ìú¥Î©¥ÏúºÎ°ú ÏßÄÏ†ï)
       		   MEMBER_PROFILE,              -- ÌîÑÎ°úÌïÑ ÏÇ¨ÏßÑ
       		   MEMBER_BACKGROUND_IMG,       -- ÌîÑÎ°úÌïÑ Î∞∞Í≤Ω ÏÇ¨ÏßÑ
       		   MEMBER_HIRE_STATUS,          -- Í≥†Ïö©ÏÉÅÌÉú , Ïù¥ÏßÅ/Íµ¨ÏßÅÏ§ë : 1, Ï±ÑÏö©Ï§ë : 2, ÌîÑÎ¶¨ÎûúÏÑú ÌôúÎèôÏ§ë : 3
			   region_name,                 -- ÏßÄÏó≠Î™Ö
			   member_career_company,       -- ÌöåÏÇ¨Î™Ö
       		   school_name                  -- ÌïôÍµêÎ™Ö
	   FROM TBL_MEMBER M
	   LEFT JOIN (SELECT TRUNC(MONTHS_BETWEEN(SYSDATE, MAX(LOGIN_DATE))) AS lastlogingap, fk_member_id
				  FROM TBL_LOGIN
				  WHERE fk_member_id = #{member_id}
				  GROUP BY fk_member_id) L
       ON M.MEMBER_ID = L.FK_MEMBER_ID
	   LEFT JOIN TBL_REGION R
	   ON M.FK_REGION_NO = R.REGION_NO
	   LEFT JOIN (SELECT member_career_company, fk_member_id
	              FROM TBL_MEMBER_CAREER
				  WHERE member_career_is_current = 1
				  ORDER BY member_career_startdate DESC) C 		-- ÌöåÏõê Í≤ΩÎ†•
	   ON M.MEMBER_ID = C.FK_MEMBER_ID
	   LEFT JOIN (SELECT fk_school_no, fk_member_id
	              FROM TBL_MEMBER_EDUCATION
				  WHERE member_education_enddate >= SYSDATE
				  ORDER BY member_education_startdate DESC) E  	 -- ÌöåÏõê ÌïôÎ†•
	   ON M.MEMBER_ID = E.FK_MEMBER_ID
	   LEFT JOIN tbl_school S
	   ON E.fk_school_no = S.school_no
	   WHERE MEMBER_STATUS = 1 AND MEMBER_ID = #{member_id} AND MEMBER_PASSWD = #{member_passwd} AND rownum = 1
	</select>
	
	
	
	
	<!--  Î°úÍ∑∏Ïù∏ Í∏∞Î°ù Ï∂îÍ∞Ä -->
	<insert id="insert_tbl_login" parameterType="HashMap">
		INSERT INTO TBL_LOGIN(LOGIN_NO, FK_MEMBER_ID, LOGIN_CLIENT_IP)
		VALUES(SEQ_LOGIN_NO.NEXTVAL, #{member_id}, #{clientip})
	</insert>
	
	
	<!-- ÌöåÏõê Ìú¥Î©¥ÏùÑ ÏûêÎèôÏúºÎ°ú ÏßÄÏ†ïÌï¥Ï£ºÎäî Ïä§ÏºÄÏ§ÑÎü¨ -->
	<update id="deactivateMember_idle">
		UPDATE tbl_member SET member_idle = 0 
		WHERE member_id = (SELECT fk_member_id
						   FROM tbl_login
						   GROUP BY fk_member_id
						   HAVING MAX(login_date) &lt; ADD_MONTHS(SYSDATE, -12))
	</update>
	
	
	<!-- Ìú¥Î©¥ Ìï¥Ï†ú Ïã§Ìñâ Î©îÏÜåÎìú -->
	<update id="memberReactivation" parameterType="String">
		UPDATE tbl_member SET member_idle = 0 WHERE member_id = #{member_id}
	</update>
	
	

	<!-- ÎπÑÎ∞ÄÎ≤àÌò∏ Ï§ëÎ≥µ ÌôïÏù∏  -->
	<select id="passwdExist" parameterType="HashMap" resultType="String">
		SELECT member_passwd
		FROM tbl_member
		WHERE member_id = #{member_id} and member_passwd = #{new_member_passwd}
	</select>
	
	
	<!-- ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÎäî ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏Ïù∏ Í≤ΩÏö∞ ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω ÌïòÍ≥† ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤ΩÎÇ†Ïßú Í∞±Ïã† -->
	<update id="passwdUpdate" parameterType="HashMap">
		UPDATE tbl_member SET member_passwd = #{new_member_passwd}, member_passwdupdate_date = SYSDATE 
		WHERE member_id = #{member_id}
	</update>
	
	

	<!-- ÏïÑÏù¥ÎîîÏ∞æÍ∏∞ Î©îÏÜåÎìú -->
	<select id="idFind" parameterType="HashMap" resultType="String">
		SELECT member_id
		FROM tbl_member
		WHERE member_name = #{member_name} AND member_email = #{member_email}
	</select>
	
	<!-- ÌöåÏõêÏù¥ Ï°¥Ïû¨ÌïòÎäîÏßÄ Í≤ÄÏÇ¨ÌïòÎäî Î©îÏÜåÎìú -->
	<select id="isExistMember" parameterType="HashMap" resultType="String">
		SELECT member_name
		FROM tbl_member
		WHERE member_id = #{member_id} AND member_passwd = #{member_passwd}
	</select>
	
	<!-- ÌöåÏõê ÌÉàÌá¥(ÎπÑÌôúÏÑ±Ìôî) -->
	<update id="memberDisable" parameterType="HashMap">
		UPDATE tbl_member SET member_status = 2 WHERE member_id = #{member_id}
	</update>
	
	
	<!-- ÌÉàÌá¥Ìïú ÌöåÏõê ÌïúÎã¨ Îí§ ÏûêÎèôÏÇ≠Ï†ú Ïä§Ï∫êÏ§ÑÎü¨ -->
	<delete id="memberDelete">
		DELETE FROM tbl_member
		WHERE member_status = (SELECT member_status
                       		   FROM tbl_member
                       		   WHERE member_disable_date &lt; ADD_MONTHS(SYSDATE, -1))
	</delete>
	
	
	<insert id="memberDisableDate">
		INSERT tbl_member(member_disable_date)
		VALUES(SYSDATE)
	</insert>
	
	
	<!-- ÌÉàÌá¥Ìïú ÌöåÏõê ÌååÏùºÎ™ÖÏùÑ Î¶¨Ïä§Ìä∏Î°ú Í∞ÄÏ†∏Ïò§Í∏∞ Í≤ÄÏÉâ -->
	<resultMap type="HashMap" id="disableFileList_map">
		<result column="member_profile"   		property="member_profile"   		javaType="String"/>
		<result column="member_background_img" 	property="member_background_img" 	javaType="String"/>
	</resultMap>
	<select id="disableFileList" resultMap="disableFileList_map">
		SELECT member_profile, member_background_img
		FROM tbl_member
		WHERE member_status = 2
	</select>
	
	
	<!-- === Ïù¥Ï§ÄÏòÅ ÎÅù === -->
	
	




	<!-- === ÍπÄÍ∑úÎπà ÏãúÏûë === -->

	<!-- ÌöåÏõê Ìïú Î™ÖÏùò Ï†ïÎ≥¥ Ï°∞Ìöå -->
	<select id="getMember" parameterType="HashMap" resultType="MemberVO">
		select member_id, m.fk_region_no, member_name
			, member_birth, member_email, member_tel, member_register_date
			, member_passwdupdate_date, member_status, member_idle
			, member_is_company , member_profile, member_background_img, member_hire_status
			, r.region_name, mc.member_career_company, s.school_name
			<!-- ÌåîÎ°úÏö∞ Ïó¨Î∂Ä ÌëúÏãú -->
			<if test="login_member_id != null">
				, NVL2(f.following_id, '1', '0') as isFollow
			</if>
		from tbl_member m
		left join tbl_member_setting ms
		on m.member_id = ms.fk_member_id
		<!-- ÌåîÎ°úÏö∞ Ïó¨Î∂Ä ÌëúÏãú -->
		<if test="login_member_id != null">
			left join
			(
				select following_id
				from tbl_follow
				where follower_id = #{login_member_id}
			) f
			on m.member_id = f.following_id
		</if>
		left join tbl_region r
		on m.fk_region_no = r.region_no
		LEFT JOIN (SELECT member_career_company, fk_member_id
					FROM TBL_MEMBER_CAREER
					WHERE member_career_is_current = 1 AND rownum = 1
					ORDER BY member_career_enddate, member_career_startdate DESC) mc
		ON m.MEMBER_ID = mc.FK_MEMBER_ID
		LEFT JOIN (SELECT fk_school_no, fk_member_id
					FROM TBL_MEMBER_EDUCATION
					WHERE member_education_enddate &gt;= SYSDATE AND rownum = 1
					ORDER BY member_education_enddate, member_education_startdate DESC) me
		ON m.MEMBER_ID = me.FK_MEMBER_ID
		LEFT JOIN tbl_school s
		on me.fk_school_no = s.school_no
		where member_id = #{member_id} and member_status = 1 and (ms.member_setting_profile = 1 OR m.member_id = #{login_member_id})
	</select>
	
	<!-- ÏûêÎèôÏôÑÏÑ±ÏùÑ ÏúÑÌïú ÏßÅÏ¢Ö Î™©Î°ù Ï°∞Ìöå Î∞è Í≤ÄÏÉâ -->
	<resultMap type="HashMap" id="jobMap">
		<result column="job_no" property="job_no" javaType="String"/>
		<result column="job_name" property="job_name" javaType="String"/>
	</resultMap>
	<select id="getJobListForAutocomplete" parameterType="HashMap" resultMap="jobMap">
		select job_no, job_name
		from tbl_job
		where job_name like '%' || #{job_name} || '%' and rownum &lt;= to_number(#{size})
	</select>
	
	<!-- ÏûêÎèôÏôÑÏÑ±ÏùÑ ÏúÑÌïú ÌöåÏÇ¨ Î™©Î°ù Ï°∞Ìöå Î∞è Í≤ÄÏÉâ -->
	<resultMap type="HashMap" id="companyMap">
		<result column="company_no"   property="company_no"   javaType="String"/>
		<result column="company_name" property="company_name" javaType="String"/>
		<result column="company_logo" property="company_logo" javaType="String"/>
	</resultMap>
	<select id="getCompanyListForAutocomplete" parameterType="HashMap" resultMap="companyMap">
		select company_no, company_name, company_logo
		from tbl_company
		where lower(company_name) like '%'|| lower(#{company_name}) || '%' and rownum &lt;= to_number(#{size})
	</select>
	
	<!-- ÏûêÎèôÏôÑÏÑ±ÏùÑ ÏúÑÌïú Ï†ÑÍ≥µ Î™©Î°ù Ï°∞Ìöå Î∞è Í≤ÄÏÉâ -->
	<resultMap type="HashMap" id="majorMap">
		<result column="major_no" property="major_no" javaType="String"/>
		<result column="major_name" property="major_name" javaType="String"/>
	</resultMap>
	<select id="getMajorListForAutocomplete" parameterType="HashMap" resultMap="majorMap">
		select major_no, major_name
		from tbl_major
		where major_name like '%'|| #{major_name} || '%' and rownum &lt;= to_number(#{size})
	</select>
	
	<!-- ÏûêÎèôÏôÑÏÑ±ÏùÑ ÏúÑÌïú ÌïôÍµê Î™©Î°ù Ï°∞Ìöå Î∞è Í≤ÄÏÉâ -->
	<resultMap type="HashMap" id="schoolMap">
		<result column="school_no"   property="school_no"   javaType="String"/>
		<result column="school_name" property="school_name" javaType="String"/>
		<result column="school_logo" property="school_logo" javaType="String"/>
	</resultMap>
	<select id="getSchoolListForAutocomplete" parameterType="HashMap" resultMap="schoolMap">
		select school_no, school_name, school_logo
		from tbl_school
		where school_name like '%'|| #{school_name} || '%' and rownum &lt;= to_number(#{size})
	</select>
	
	<!-- ÏûêÎèôÏôÑÏÑ±ÏùÑ ÏúÑÌïú Î≥¥Ïú†Í∏∞Ïà† Î™©Î°ù Ï°∞Ìöå Î∞è Í≤ÄÏÉâ -->
	<resultMap type="HashMap" id="skillMap">
		<result column="skill_no" property="skill_no" javaType="String"/>
		<result column="skill_name" property="skill_name" javaType="String"/>
	</resultMap>
	<select id="getSkillListForAutocomplete" parameterType="HashMap" resultMap="skillMap">
		select skill_no, skill_name
		from tbl_skill
		where skill_name like '%'|| #{skill_name} || '%' and rownum &lt;= to_number(#{size})
	</select>
	
	<!-- === ÌöåÏõê Í≤ΩÎ†• ÏãúÏûë === -->
	<!-- ÌöåÏõê Í≤ΩÎ†• 1Í∞ú Ï°∞Ìöå -->
	<select id="getMemberCareer" parameterType="HashMap" resultType="MemberCareerVO">
		SELECT member_career_no, mc.fk_member_id, mc.fk_region_no, r.region_name
			 , mc.fk_job_no, j.job_name, fk_company_no, company_logo, member_career_company, member_career_type
			 , to_char(member_career_startdate, 'yyyy-mm') AS member_career_startdate
			 , to_char(member_career_enddate, 'yyyy-mm') AS member_career_enddate
			 , member_career_explain
			 , member_career_is_current
		FROM tbl_member_career mc
		JOIN tbl_member_setting ms
		ON mc.fk_member_id = ms.fk_member_id
		JOIN tbl_region r
		ON mc.fk_region_no = r.region_no
		JOIN tbl_job j
		ON mc.fk_job_no = j.job_no
		LEFT JOIN tbl_company c
		ON mc.fk_company_no = c.company_no
		WHERE member_career_no = #{member_career_no} AND (ms.member_setting_profile = 1 OR mc.fk_member_id = #{login_member_id})
	</select>
	
	<!-- Ìïú ÌöåÏõêÏùò Í≤ΩÎ†• Î™®Îëê Ï°∞Ìöå -->
	<select id="getMemberCareerListByMemberId" parameterType="HashMap" resultType="MemberCareerVO">
		SELECT member_career_no, mc.fk_member_id, mc.fk_region_no, r.region_name
			 , mc.fk_job_no, j.job_name, fk_company_no, company_logo, member_career_company, member_career_type
			 , to_char(member_career_startdate, 'yyyy-mm') AS member_career_startdate
			 , to_char(member_career_enddate, 'yyyy-mm') AS member_career_enddate
			 , member_career_explain
			 , member_career_is_current
		FROM tbl_member_career mc
		JOIN tbl_member_setting ms
		ON mc.fk_member_id = ms.fk_member_id
		JOIN tbl_region r
		ON mc.fk_region_no = r.region_no
		JOIN tbl_job j
		ON mc.fk_job_no = j.job_no
		LEFT JOIN tbl_company c
		ON mc.fk_company_no = c.company_no
		WHERE mc.fk_member_id = #{member_id} AND (ms.member_setting_profile = 1 OR mc.fk_member_id = #{login_member_id})
		<if test="size != null">AND rownum &lt;= #{size}</if>
		ORDER BY member_career_enddate DESC, member_career_startdate DESC
	</select>

	<!-- ÌöåÏõê Í≤ΩÎ†• Îì±Î°ù -->
	<insert id="insertMemberCareer" parameterType="MemberCareerVO">
		insert into tbl_member_career(member_career_no, fk_member_id, fk_region_no, fk_job_no, fk_company_no, member_career_is_current
		          , member_career_company, member_career_type, member_career_startdate, member_career_enddate, member_career_explain)
		values(seq_member_career_no.nextval, #{fk_member_id}, to_number(#{fk_region_no}), to_number(#{fk_job_no})
			 <if test="fk_company_no != null">, to_number(#{fk_company_no})</if>
			 <if test="fk_company_no == null">, null</if>
			 <if test="member_career_is_current != null">, 1</if>
			 <if test="member_career_is_current == null">, 0</if>
		     , #{member_career_company}, to_number(#{member_career_type}), to_date(#{member_career_startdate}, 'yyyy-mm')
		     <if test="member_career_enddate != null">, to_date(#{member_career_enddate}, 'yyyy-mm')</if>
		     <if test="member_career_enddate == null">, null</if>
		     , #{member_career_explain})
	</insert>
	
	<!-- ÌöåÏõê Í≤ΩÎ†• ÏàòÏ†ï -->
	<update id="updateMemberCareer" parameterType="MemberCareerVO">
		update tbl_member_career set fk_region_no = to_number(#{fk_region_no}), fk_job_no = to_number(#{fk_job_no})
				  <if test="fk_company_no != null">,fk_company_no = to_number(#{fk_company_no})</if>
				  <if test="fk_company_no == null">,fk_company_no = null</if>
			      <if test="member_career_is_current != null">, member_career_is_current = 1</if>
			      <if test="member_career_is_current == null">, member_career_is_current = 0</if>
		          , member_career_company = #{member_career_company}, member_career_type = to_number(#{member_career_type})
		          , member_career_startdate = to_date(#{member_career_startdate}, 'yyyy-mm')
			      <if test="member_career_enddate != null">,member_career_enddate = to_date(#{member_career_enddate}, 'yyyy-mm')</if>
			      <if test="member_career_enddate == null">,member_career_enddate = null</if>
		          , member_career_explain = #{member_career_explain}
		where member_career_no = #{member_career_no} and fk_member_id = #{fk_member_id}
	</update>
	
	<!-- ÌöåÏõê Í≤ΩÎ†• ÏÇ≠Ï†ú -->
	<delete id="deleteMemberCareer" parameterType="HashMap">
		delete from tbl_member_career
		where member_career_no = #{member_career_no} and fk_member_id = #{fk_member_id}
	</delete>
	<!-- === ÌöåÏõê Í≤ΩÎ†• ÎÅù === -->
	
	<!-- === ÌöåÏõê ÌïôÎ†• ÏãúÏûë === -->
	<!-- ÌöåÏõê ÌïôÎ†• 1Í∞ú Ï°∞Ìöå -->
	<select id="getMemberEducation" parameterType="HashMap" resultType="MemberEducationVO">
		select member_education_no, me.fk_member_id, fk_school_no, school_name, school_logo, fk_major_no, major_name
			, member_education_degree
			, to_char(member_education_startdate, 'yyyy-mm') AS member_education_startdate
			, to_char(member_education_enddate, 'yyyy-mm') AS member_education_enddate
			, member_education_grade, member_education_explain
		from tbl_member_education me
		JOIN tbl_member_setting ms
		ON me.fk_member_id = ms.fk_member_id
		join tbl_school s
		on me.fk_school_no = s.school_no
		join tbl_major m
		on me.fk_major_no = m.major_no
		WHERE member_education_no = #{member_education_no} AND (ms.member_setting_profile = 1 OR me.fk_member_id = #{login_member_id})
	</select>
	
	<!-- Ìïú ÌöåÏõêÏùò ÌïôÎ†• Î™®Îëê Ï°∞Ìöå -->
	<select id="getMemberEducationListByMemberId" parameterType="HashMap" resultType="MemberEducationVO">
		select member_education_no, me.fk_member_id, fk_school_no, school_name, school_logo, fk_major_no, major_name
			, member_education_degree
			, to_char(member_education_startdate, 'yyyy-mm') AS member_education_startdate
			, to_char(member_education_enddate, 'yyyy-mm') AS member_education_enddate
			, member_education_grade, member_education_explain
		from tbl_member_education me
		JOIN tbl_member_setting ms
		ON me.fk_member_id = ms.fk_member_id
		join tbl_school s
		on me.fk_school_no = s.school_no
		join tbl_major m
		on me.fk_major_no = m.major_no
		WHERE me.fk_member_id = #{member_id} AND (ms.member_setting_profile = 1 OR me.fk_member_id = #{login_member_id})
		<if test="size != null">AND rownum &lt;= #{size}</if>
		ORDER BY member_education_enddate DESC, member_education_startdate DESC
	</select>

	<!-- ÌöåÏõê ÌïôÎ†• Îì±Î°ù -->
	<insert id="insertMemberEducation" parameterType="MemberEducationVO">
		insert into tbl_member_education(member_education_no, fk_member_id, fk_school_no, 
			fk_major_no, member_education_degree, member_education_startdate,
			member_education_enddate, member_education_grade,
			member_education_explain)
		values(seq_member_education_no.nextval, #{fk_member_id}, to_number(#{fk_school_no}), to_number(#{fk_major_no}),
			to_number(#{member_education_degree}),
			to_date(#{member_education_startdate}, 'yyyy-mm'),
			to_date(#{member_education_enddate}, 'yyyy-mm'),
			to_number(#{member_education_grade}), #{member_education_explain})
	</insert>
	
	<!-- ÌöåÏõê ÌïôÎ†• ÏàòÏ†ï -->
	<update id="updateMemberEducation" parameterType="MemberEducationVO">
		update tbl_member_education SET fk_member_id = #{fk_member_id}, 
			fk_school_no = to_number(#{fk_school_no}),
			fk_major_no = to_number(#{fk_major_no}),
			member_education_degree = to_number(#{member_education_degree}),
			member_education_startdate = to_date(#{member_education_startdate}, 'yyyy-mm'),
			member_education_enddate = to_date(#{member_education_enddate}, 'yyyy-mm'),
			member_education_grade = to_number(#{member_education_grade}),
			member_education_explain = #{member_education_explain}
		where member_education_no = #{member_education_no} and fk_member_id = #{fk_member_id}
	</update>
	
	<!-- ÌöåÏõê ÌïôÎ†• ÏÇ≠Ï†ú -->
	<delete id="deleteMemberEducation" parameterType="HashMap">
		delete from tbl_member_education
		where member_education_no = #{member_education_no} and fk_member_id = #{fk_member_id}
	</delete>
	<!-- === ÌöåÏõê ÌïôÎ†• ÎÅù === -->
	
	<!-- === ÌöåÏõê Î≥¥Ïú†Í∏∞Ïà† ÏãúÏûë === -->
	<!-- ÌöåÏõê Î≥¥Ïú†Í∏∞Ïà† 1Í∞ú Ï°∞Ìöå -->
	<select id="getMemberSkill" parameterType="HashMap" resultType="MemberSkillVO">
		select member_skill_no, msk.fk_member_id, fk_skill_no, skill_name
		from tbl_member_skill msk
		join tbl_member_setting ms
		on msk.fk_member_id = ms.fk_member_id
		join tbl_skill sk
		on msk.fk_skill_no = sk.skill_no
		where member_skill_no = #{member_skill_no} AND (ms.member_setting_profile = 1 OR msk.fk_member_id = #{login_member_id})
		ORDER BY skill_name
	</select>
	
	<!-- Ìïú ÌöåÏõêÏùò Î≥¥Ïú†Í∏∞Ïà† Î™®Îëê Ï°∞Ìöå -->
	<select id="getMemberSkillListByMemberId" parameterType="HashMap" resultType="MemberSkillVO">
		select member_skill_no, msk.fk_member_id, fk_skill_no, skill_name
		from tbl_member_skill msk
		join tbl_member_setting ms
		on msk.fk_member_id = ms.fk_member_id
		join tbl_skill sk
		on msk.fk_skill_no = sk.skill_no
		WHERE msk.fk_member_id = #{member_id} AND (ms.member_setting_profile = 1 OR msk.fk_member_id = #{login_member_id})
		<if test="size != null">AND rownum &lt;= #{size}</if>
	</select>

	<!-- ÌöåÏõê Î≥¥Ïú†Í∏∞Ïà† Îì±Î°ù -->
	<insert id="insertMemberSkill" parameterType="MemberSkillVO">
		insert into tbl_member_skill(member_skill_no, fk_member_id, fk_skill_no)
		values(seq_member_skill_no.nextval, #{fk_member_id}, #{fk_skill_no})
	</insert>
	
	<!-- ÌöåÏõê Î≥¥Ïú†Í∏∞Ïà† ÏÇ≠Ï†ú -->
	<delete id="deleteMemberSkill" parameterType="HashMap">
		delete from tbl_member_skill
		where member_skill_no = #{member_skill_no} and fk_member_id = #{fk_member_id}
	</delete>
	<!-- === ÌöåÏõê Î≥¥Ïú†Í∏∞Ïà† ÎÅù === -->

	<!-- ÌöåÏõêÏùò Ïù¥Î¶Ñ, ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ Î™©Î°ù Ï°∞Ìöå -->
	<select id="getMemberListByMemberId" parameterType="ArrayList" resultType="MemberVO">
		select member_id, member_birth, member_name, member_profile
		from tbl_member m
		where member_id in
		<foreach collection="memberIdList" index="i" open="(" separator="," close=")">
			'${memberIdList[i]}'
		</foreach>
		and member_status = 1
		order by DECODE(member_id, 
		<foreach collection="memberIdList" index="i" open="" separator="," close=")">
			'${memberIdList[i]}',${i}
		</foreach>
	</select>

	<!-- ÌöåÏõê ÌîÑÎ°úÌïÑ Î∞∞Í≤Ω ÏàòÏ†ï -->
	<update id="updateMemberBackgroundImg" parameterType="MemberVO">
		update tbl_member SET member_background_img = #{member_background_img}
		where member_id = #{member_id}
	</update>

	<!-- ÌöåÏõê ÌîÑÎ°úÌïÑ ÏÇ¨ÏßÑ ÏàòÏ†ï -->
	<update id="updateMemberProfile" parameterType="MemberVO">
		update tbl_member SET member_profile = #{member_profile}
		where member_id = #{member_id}
	</update>

	<!-- ÌåîÎ°úÏõå Ïàò Í∞ÄÏ†∏Ïò§Í∏∞ -->
	<select id="getFollowerCount" parameterType="String" resultType="int">
		select count(*) AS followerCount
		from tbl_follow
		where following_id = #{member_id}
	</select>

	<!-- ÌöåÏõê Ï†ïÎ≥¥ ÏàòÏ†ï -->
	<update id="updateMember" parameterType="MemberVO">
		UPDATE tbl_member SET member_id = member_id
		<if test='member_passwd != ""'>
			, member_passwd = #{member_passwd}
			, member_passwdupdate_date = SYSDATE
		</if>
		<if test='member_name != ""'>
			, member_name = #{member_name}
		</if>
		<if test='member_birth != ""'>
			, member_birth = #{member_birth}
		</if>
		<if test='member_email != ""'>
			, member_email = #{member_email}
		</if>
		<if test='member_tel != ""'>
			, member_tel = #{member_tel}
		</if>
		<if test='fk_region_no != ""'>
			, fk_region_no = #{fk_region_no}
		</if>
		WHERE member_id = #{member_id}
	</update>

	<!-- === ÍπÄÍ∑úÎπà ÎÅù === -->

	<!-- === Ïó∞Í∑úÏòÅ ÏãúÏûë === -->
	<select id="getAlarmMemberInfoByMemberId" resultType="MemberVO">
		select member_id, member_birth, member_is_company ,member_name, member_profile
		from tbl_member where member_id = #{member_id}
	</select>


	<!-- === Ïó∞Í∑úÏòÅ ÎÅù === -->

	<!-- === Ïù¥ÏßÑÌò∏ ÏãúÏûë === -->
	<!-- üö® Ïã†Í≥† Í∏∞Î°ù Ï∂îÍ∞Ä üö®  --> 
	<insert id="createReport" parameterType="ReportVO">
   		 insert into tbl_report (report_no, fk_member_id, fk_reported_member_id, report_type, additional_explanation)
   		 values (seq_report_no.nextval, #{fk_member_id}, #{fk_reported_member_id}, #{report_type}, #{additional_explanation})
	</insert>


<!--  üö® Ïã†Í≥† ÌöüÏàò Ï°∞Ìöå üö® 
	<select id="getReportedCount" resultType="int" parameterType="string">
		select count(*)
		from tbl_report
		where fk_reported_member_id = #{reportedMemberId}
	</select>

	üö® ÌöåÏõê Ï†ïÏßÄ Ï≤òÎ¶¨ üö®
	<update id="banMember" parameterType="string">
		update tbl_member
		set member_status = 3
		where member_id = #{reportedMemberId}
-->

	<!-- === Ïù¥ÏßÑÌò∏ ÎÅù === -->
</mapper>
